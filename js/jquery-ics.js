(function(e){function t(t){if(t){var n=e.ajax({url:t,type:"HEAD",async:false}).status;return n!="200"?false:true}return false}function n(t){var n={};n["event"]=new Array;n["todo"]=new Array;n["journal"]=new Array;n["freebusy"]=new Array;n["timezone"]=new Array;e.ajax({url:t,dataType:"text",async:false,success:function(e){var t=e.split("\r\n");var i=r(t,n,0);if(!(n["event"].length>0||n["todo"].length>0||n["journal"].length>0||n["freebusy"].length>0||n["timezone"].length>0)){throw"At least one main object (event, todo, journal, freebusy or timezone) has to be set."}while(t[i]==""){i++}if(i!=t.length){throw"Unable to process the whole ics file."}}});return n}function r(e,t,n){if(!(e[n]=="BEGIN:VCALENDAR")){throw"Syntax error: No BEGIN:VCALENDAR found."}n++;t.type="VCALENDAR";while(n<e.length){var r=p(e[n]);if(r.name!="END"&&r.name!="BEGIN"){if(!t[r.name.toLowerCase()]){t[r.name.toLowerCase()]=new Array}t[r.name.toLowerCase()].push(r);n++}else{break}}h({obj:t,props:[{name:"calscale",min:0,max:1},{name:"method",min:0,max:1},{name:"prodid",min:1,max:1},{name:"version",min:1,max:1},{name:"x-prop",min:0,max:1}]});while(n<e.length){var f=e[n].split(":");var l=f[0];var c=f[1];if(l=="BEGIN"){switch(c){case"VEVENT":n=i(e,t.event,n);break;case"VTODO":n=s(e,t.todo,n);break;case"VJOURNAL":n=o(e,t.journal,n);break;case"VFREEBUSY":n=u(e,t.freebusy,n);break;case"VTIMEZONE":n=a(e,t.timezone,n);break;default:break}}else{break}}if(!(e[n]=="END:VCALENDAR")){throw"Syntax error: No END:VCALENDAR found."}return++n}function i(e,t,n){if(!(e[n]=="BEGIN:VEVENT")){throw"Syntax error: No BEGIN:VEVENT found."}n++;var r={};r.alarm=new Array;r.type="VEVENT";while(n<e.length){var i=p(e[n]);if(i.name!="END"&&i.name!="BEGIN"){if(!r[i.name.toLowerCase()]){r[i.name.toLowerCase()]=new Array}r[i.name.toLowerCase()].push(i);n++}else if(i.name=="BEGIN"&&i.value=="VALARM"){n=f(e,r.alarm,n)}else{break}}h({obj:r,props:[{name:"attach",min:0,max:Number.MAX_VALUE},{name:"attendee",min:0,max:Number.MAX_VALUE},{name:"categories",min:0,max:Number.MAX_VALUE},{name:"class",min:0,max:1},{name:"comment",min:0,max:Number.MAX_VALUE},{name:"contact",min:0,max:Number.MAX_VALUE},{name:"created",min:0,max:1},{name:"description",min:0,max:1},{name:"dtend",min:1,max:1,en:"duration"},{name:"dtstamp",min:0,max:1},{name:"dtstart",min:0,max:1},{name:"duration",min:1,max:1,en:"dtend"},{name:"exdate",min:0,max:1},{name:"exrule",min:0,max:1},{name:"geo",min:0,max:1},{name:"last-mod",min:0,max:1},{name:"location",min:0,max:1},{name:"organizer",min:0,max:1},{name:"priority",min:0,max:1},{name:"rdate",min:0,max:Number.MAX_VALUE},{name:"recurId",min:0,max:1},{name:"related",min:0,max:Number.MAX_VALUE},{name:"resources",min:0,max:Number.MAX_VALUE},{name:"rrule",min:0,max:Number.MAX_VALUE},{name:"rstatus",min:0,max:Number.MAX_VALUE},{name:"seq",min:0,max:1},{name:"status",min:0,max:1},{name:"summary",min:0,max:1},{name:"transp",min:0,max:1},{name:"uid",min:0,max:1},{name:"url",min:0,max:1},{name:"x-prop",min:0,max:Number.MAX_VALUE}]});if(!(e[n]=="END:VEVENT")){throw"Syntax error: No END:VEVENT found."}t.push(r);return++n}function s(e,t,n){if(!(e[n]=="BEGIN:VTODO")){throw"Syntax error: No BEGIN:VTODO found."}n++;var r={};r.alarm=new Array;r.type="VTODO";while(n<e.length){var i=p(e[n]);if(i.name!="END"&&i.name!="BEGIN"){if(!r[i.name.toLowerCase()]){r[i.name.toLowerCase()]=new Array}r[i.name.toLowerCase()].push(i);n++}else if(i.name=="BEGIN"&&i.value=="VALARM"){n=f(e,r.alarm,n)}else{break}}h({obj:r,props:[{name:"attach",min:0,max:Number.MAX_VALUE},{name:"attendee",min:0,max:Number.MAX_VALUE},{name:"categories",min:0,max:Number.MAX_VALUE},{name:"class",min:0,max:1},{name:"comment",min:0,max:Number.MAX_VALUE},{name:"completed",min:0,max:1},{name:"contact",min:0,max:Number.MAX_VALUE},{name:"created",min:0,max:1},{name:"description",min:0,max:1},{name:"dtstamp",min:0,max:1},{name:"dtstart",min:0,max:1},{name:"due",min:1,max:1,en:"duration"},{name:"duration",min:1,max:1,en:"due"},{name:"exdate",min:0,max:1},{name:"exrule",min:0,max:1},{name:"geo",min:0,max:1},{name:"last-mod",min:0,max:1},{name:"location",min:0,max:1},{name:"organizer",min:0,max:1},{name:"percent",min:0,max:1},{name:"priority",min:0,max:1},{name:"rdate",min:0,max:Number.MAX_VALUE},{name:"recurId",min:0,max:1},{name:"related",min:0,max:Number.MAX_VALUE},{name:"resources",min:0,max:Number.MAX_VALUE},{name:"rrule",min:0,max:Number.MAX_VALUE},{name:"rstatus",min:0,max:Number.MAX_VALUE},{name:"seq",min:0,max:1},{name:"status",min:0,max:1},{name:"summary",min:0,max:1},{name:"uid",min:0,max:1},{name:"url",min:0,max:1},{name:"x-prop",min:0,max:Number.MAX_VALUE}]});if(!(e[n]=="END:VTODO")){throw"Syntax error: No END:VTODO found."}t.push(r);return++n}function o(e,t,n){if(!(e[n]=="BEGIN:VJOURNAL")){throw"Syntax error: No BEGIN:VJOURNAL found."}n++;var r={};r.type="VJOURNAL";while(n<e.length){var i=p(e[n]);if(i.name!="END"&&i.name!="BEGIN"){if(!r[i.name.toLowerCase()]){r[i.name.toLowerCase()]=new Array}r[i.name.toLowerCase()].push(i);n++}else{break}}h({obj:r,props:[{name:"attach",min:0,max:Number.MAX_VALUE},{name:"attendee",min:0,max:Number.MAX_VALUE},{name:"categories",min:0,max:Number.MAX_VALUE},{name:"class",min:0,max:1},{name:"comment",min:0,max:Number.MAX_VALUE},{name:"contact",min:0,max:Number.MAX_VALUE},{name:"created",min:0,max:1},{name:"description",min:0,max:1},{name:"dtstamp",min:0,max:1},{name:"dtstart",min:0,max:1},{name:"exdate",min:0,max:1},{name:"exrule",min:0,max:1},{name:"last-mod",min:0,max:1},{name:"organizer",min:0,max:1},{name:"rdate",min:0,max:Number.MAX_VALUE},{name:"recurId",min:0,max:1},{name:"related",min:0,max:Number.MAX_VALUE},{name:"rrule",min:0,max:Number.MAX_VALUE},{name:"rstatus",min:0,max:Number.MAX_VALUE},{name:"seq",min:0,max:1},{name:"status",min:0,max:1},{name:"summary",min:0,max:1},{name:"uid",min:0,max:1},{name:"url",min:0,max:1},{name:"x-prop",min:0,max:Number.MAX_VALUE}]});if(!(e[n]=="END:VJOURNAL")){throw"Syntax error: No END:VJOURNAL found."}t.push(r);return++n}function u(e,t,n){if(!(e[n]=="BEGIN:VFREEBUSY")){throw"Syntax error: No BEGIN:VFREEBUSY found."}n++;var r={};r.type="VFREEBUSY";while(n<e.length){var i=p(e[n]);if(i.name!="END"&&i.name!="BEGIN"){if(!r[i.name.toLowerCase()]){r[i.name.toLowerCase()]=new Array}r[i.name.toLowerCase()].push(i);n++}else{break}}h({obj:r,props:[{name:"attendee",min:0,max:Number.MAX_VALUE},{name:"comment",min:0,max:Number.MAX_VALUE},{name:"contact",min:0,max:1},{name:"dtend",min:0,max:1},{name:"dtstamp",min:0,max:1},{name:"dtstart",min:0,max:1},{name:"duration",min:0,max:1},{name:"freebusy",min:0,max:Number.MAX_VALUE},{name:"organizer",min:0,max:1},{name:"rstatus",min:0,max:NUMBER.MAX_VALUE},{name:"uid",min:0,max:1},{name:"url",min:0,max:1},{name:"x-prop",min:0,max:NUMBER.MAX_VALUE}]});if(!(e[n]=="END:VFREEBUSY")){throw"Syntax error: No END:VFREEBUSY found."}t.push(r);return++n}function a(e,t,n){if(!(e[n]=="BEGIN:VTIMEZONE")){throw"Syntax error: No BEGIN:VTIMEZONE found."}n++;var r={};r.type="VTIMEZONE";r.standard=new Array;r.daylight=new Array;while(n<e.length){var i=p(e[n]);if(i.name!="END"&&i.name!="BEGIN"){if(!r[i.name.toLowerCase()]){r[i.name.toLowerCase()]=new Array}r[i.name.toLowerCase()].push(i);n++}else if(i.name=="BEGIN"&&i.value=="STANDARD"){n=l(e,r.standard,n)}else if(i.name=="BEGIN"&&i.value=="DAYLIGHT"){n=c(e,r.daylight,n)}else{break}}h({obj:r,props:[{name:"last-mod",min:0,max:1},{name:"tzid",min:1,max:1},{name:"tzurl",min:0,max:1}]});if(!(r.standard.length>0||r.daylight.length>0)){throw"VTIMEZONE needs at least one of STANDARD or DAYLIGHT to be set"}if(!(e[n]=="END:VTIMEZONE")){throw"Syntax error: No END:VTIMEZONE found."}t.push(r);return++n}function f(e,t,n){if(!(e[n]=="BEGIN:VALARM")){throw"Syntax error: No BEGIN:VALARM found."}n++;var r={};r.type="VALARM";while(n<e.length){var i=p(e[n]);if(i.name!="END"&&i.name!="BEGIN"){if(!r[i.name.toLowerCase()]){r[i.name.toLowerCase()]=new Array}r[i.name.toLowerCase()].push(i);n++}else{break}}switch(r.action[0].value){case"AUDIO":h({obj:r,props:[{name:"action",min:1,max:1},{name:"attach",min:0,max:1},{name:"duration",min:0,max:1,"in":"repeat"},{name:"repeat",min:0,max:1,"in":"duration"},{name:"trigger",min:1,max:1},{name:"tzurl",min:0,max:1}]});break;case"DISPLAY":h({obj:r,props:[{name:"action",min:1,max:1},{name:"description",min:1,max:1},{name:"duration",min:0,max:1,"in":"repeat"},{name:"repeat",min:0,max:1,"in":"duration"},{name:"trigger",min:1,max:1},{name:"tzurl",min:0,max:1}]});break;case"EMAIL":h({obj:r,props:[{name:"action",min:1,max:1},{name:"attach",min:0,max:Number.MAX_VALUE},{name:"attendee",min:1,max:Number.MAX_VALUE},{name:"description",min:1,max:1},{name:"duration",min:0,max:1,"in":"repeat"},{name:"repeat",min:0,max:1,"in":"duration"},{name:"summary",min:1,max:1},{name:"trigger",min:1,max:1},{name:"tzurl",min:0,max:1}]});break;case"PROCEDURE":h({obj:r,props:[{name:"action",min:1,max:1},{name:"attach",min:1,max:1},{name:"description",min:0,max:1},{name:"duration",min:0,max:1,"in":"repeat"},{name:"repeat",min:0,max:1,"in":"duration"},{name:"trigger",min:1,max:1},{name:"tzurl",min:0,max:1}]});break;default:throw"Unkown action '"+r.action[0].name+"' for VALARM";break}if(!(e[n]=="END:VALARM")){throw"Syntax error: No END:VALARM found."}t.push(r);return++n}function l(e,t,n){if(!(e[n]=="BEGIN:STANDARD")){throw"Syntax error: No BEGIN:STANDARD found."}n++;var r={};r.type="STANDARD";while(n<e.length){var i=p(e[n]);if(i.name!="END"&&i.name!="BEGIN"){if(!r[i.name.toLowerCase()]){r[i.name.toLowerCase()]=new Array}r[i.name.toLowerCase()].push(i);n++}else{break}}h({obj:r,props:[{name:"dtstart",min:1,max:1},{name:"tzid",min:0,max:Number.MAX_VALUE},{name:"tzname",min:0,max:1},{name:"tzoffsetto",min:1,max:1}]});if(!(e[n]=="END:STANDARD")){throw"Syntax error: No END:STANDARD found."}t.push(r);return++n}function c(e,t,n){if(!(e[n]=="BEGIN:DAYLIGHT")){throw"Syntax error: No BEGIN:DAYLIGHT found."}n++;var r={};r.type="DAYLIGHT";while(n<e.length){var i=p(e[n]);if(i.name!="END"&&i.name!="BEGIN"){if(!r[i.name.toLowerCase()]){r[i.name.toLowerCase()]=new Array}r[i.name.toLowerCase()].push(i);n++}else{break}}h({obj:r,props:[{name:"dtstart",min:1,max:1},{name:"tzid",min:0,max:Number.MAX_VALUE},{name:"tzname",min:0,max:1},{name:"tzoffsetto",min:1,max:1}]});if(!(e[n]=="END:DAYLIGHT")){throw"Syntax error: No END:DAYLIGHT found."}t.push(r);return++n}function h(t){e.each(t.props,function(e,n){var r=t.obj[n.name];if(!n.en&&!n.in){if(!r&&n.min>0){throw"Property '"+n.name+"' is mandatory for "+t.obj.type}if(r){if(!(n.min<=r.length&&r.length<=n.max)){throw"Property '"+n.name+"' occures too much/less on "+t.obj.type}}}else{if(n.en){if(r&&t.obj[n.en]&&t.obj[n.en][0]){throw"Property '"+n.en+"' is not allowed if property '"+n.name+"' is set on "+t.obj.type}}else if(n.in){console.log(t.obj);if(!r&&!t.obj[n.in]&&!t.obj[n.in][0]){throw"Property '"+n.name+"' needs the property '"+n.in+"' to be set on"+t.obj.type}}}})}function p(e){var t={};t.params=new Array;var n=e.indexOf(":");t.value=e.slice(n+1,e.length);var r=e.slice(0,n).split(";");t.name=r[0];for(var i=1;i<r.length;i++){var s={};var o=r[i].split("=");s.key=o[0];s.value=o[1];t.params.push(s)}return t}e.parseIcs=function(e){if(!t(e)){throw"Unable to load file from: "+e}return n(e)}})(jQuery)